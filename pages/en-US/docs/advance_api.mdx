---
title: Advanced API
description: Advanced API for handling Excel files
---

FastExcel provides a simple and easy-to-use API for handling Excel files, supporting advanced features such as reading, writing, interceptors, custom styles, etc., allowing developers to flexibly handle various complex business scenarios.

# Core Concepts
If you need to perform a large amount of detailed reading and writing operations on Excel, you need to understand some important concepts and classes in FastExcel. They can provide rich options when you try to customize operations.
- `FastExcel`: Entry class used to start various operations
- `ExcelReaderBuilder`: ExcelWriterBuilder constructs a ReadWorkbook WriteWorkbook, which can be understood as an excel object, with only one excel being built
- `ExcelReaderSheetBuilder`: ExcelWriterSheetBuilder constructs a ReadSheet WriteSheet object, which can be understood as a page in excel, each page needs to be built
- `ReadListener`: Called to handle data after each row is read
- `WriteHandler`: Called to handle data for each operation including creating cells, creating tables, etc.

All configurations are inherited, Workbook configurations will be inherited by Sheet, so when setting parameters with FastExcel, the scope before the FastExcel...sheet() method is the entire sheet, and after that, it is specific to a single sheet.

# Entity Class Annotations
Entity classes are the foundation of read and write operations. FastExcel provides various annotations to help developers easily define fields and formats.
## **`@ExcelProperty`**
Defines the column name in Excel and the field name to map. Specific parameters are as follows:

| Name                  | Default Value       | Description                                                                                   |
|-----------------------|---------------------|-----------------------------------------------------------------------------------------------|
| value                 | Empty               | Used to match the header in Excel, must match completely. If there are multiple rows of headers, it will match the last row of headers. |
| order                 | Integer.MAX_VALUE   | Higher priority than `value`, will match the order of entities and data in Excel based on the order of `order`. |
| index                 | -1                  | Higher priority than `value` and `order`, will directly specify which column in Excel to match based on `index`. |
| converter             | Automatically selected | Specifies which converter the current field uses, it will be automatically selected by default. Just need to implement the `cn.idev.excel.converters.Converter#convertToJavaData(com.idev.excel.converters.ReadConverterContext<?>)` method for reading situations.

## **`@ColumnWidth`**
Specifies the column width.

## **`@DateTimeFormat`**
Date conversion, using `String` to receive Excel date format data will trigger this annotation, with the following parameters:

| Name                  | Default Value  | Description                                                             |
|-----------------------|---------------|-------------------------------------------------------------------------|
| value                 | Empty         | Write according to `java.text.SimpleDateFormat`.                        |
| use1904windowing      | Automatically selected | Excel stores time as a double precision floating point number starting from 1900, but sometimes the default start date is 1904, so setting this value changes the default start to 1904.

## **`@NumberFormat`**
Number conversion, using `String` to receive Excel number format data will trigger this annotation.

| Name                  | Default Value  | Description                                                             |
|-----------------------|---------------|-------------------------------------------------------------------------|
| value                 | Empty         | Write according to `java.text.DecimalFormat`.                          |
| roundingMode          | RoundingMode.HALF_UP | Set the rounding mode when formatting.

# Reading Operations

`ReadWorkbook` and `ReadSheet` have common parameters, which default to the parent.
| Name                  | Default Value | Description                                                       |
|-----------------------|---------------|-------------------------------------------------------------------|
| converter             | Empty         | Many converters are loaded by default. You can add unsupported fields here. |
| readListener          | Empty         | Can register multiple listeners, which will be continuously called back when reading Excel. |
| headRowNumber         | 1             | The number of rows in the header of Excel, default is 1 row.      |
| head                  | Empty         | Either `head` or `clazz`. Reads the list corresponding to the file header and matches the data based on the list. It is recommended to use class. |
| clazz                 | Empty         | Either `head` or `clazz`. Reads the class corresponding to the file header, which can also use annotations. If neither is specified, all data will be read. |
| autoTrim              | true          | Automatically trims the header, reads data, etc.                  |
| use1904windowing      | false         | Excel stores time as a double precision floating point number starting from 1900, but sometimes the default start date is 1904, so setting this value changes the default start to 1904. |
| useScientificFormat   | false         | Whether to use scientific notation for large numerical values when converting numbers to text.

## ReadWorkbook (understood as an excel object) parameters
| Name                  | Default Value | Description                                                                                                                |
|-----------------------|---------------|----------------------------------------------------------------------------------------------------------------------------|
| excelType             | Empty         | The current excel type, supports XLS, XLSX, CSV.                                                                           |
| inputStream           | Empty         | Either `file` or `inputStream`. Reads the file stream, if a stream is received, it is used directly. If not, it is recommended to use the `file` parameter. Since `inputStream` is used, FastExcel will help create a temporary file, but in the end it is still `file`. |
| file                  | Empty         | Either `inputStream` or `file`. Reads the file.                                                                            |
| mandatoryUseInputStream | false         | Forces the use of `inputStream` to create objects, which may degrade performance but will not create temporary files. |
| charset               | Charset#defaultCharset | Only useful for CSV files, specifies the encoding used when reading the file.                                             |
| autoCloseStream       | true          | Automatically closes the read stream.                                                                                      |
| readCache             | Empty         | Uses memory for less than 5M by default, and uses `EhCache` for more than 5M. It is not recommended to use this parameter. |
| readCacheSelector     | SimpleReadCacheSelector | Used to select when to use memory to store temporary data and when to use disk to store temporary data.                  |
| ignoreEmptyRow        | true          | Ignores empty rows.                                                                                                        |
| password              | Empty         | Password for reading the file.                                                                                             |
| xlsxSAXParserFactoryName | Empty       | Specifies the name of the class used for sax reading, for example: `com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl`. |
| useDefaultListener    | true          | `@since 2.1.4` <br/>By default, `ModelBuildEventListener` is added to help convert to the object passed in. If set to `false`, it will not assist in converting objects, and custom listeners will receive a `Map<Integer, CellData>` object. If you still want to receive `class` objects, call the `readListener` method and add custom `beforeListener`, `ModelBuildEventListener`, and custom `afterListener`. |
| extraReadSet          | Empty         | Set of additional content to be read, not read by default.                                                                  |
| readDefaultReturn     | STRING        | `@since 3.2.0`<br/>STRING: Returns an array of Map&lt;Integer,Object&gt;, the return value is the content you see in the excel cell without clicking on it.<br/>ACTUAL_DATA: Returns an array of Map&lt;Integer,Object&gt;, the actual stored data, will automatically convert types, Object type can be `BigDecimal`, `Boolean`, `String`, `LocalDateTime`, null.<br/>READ_CELL_DATA: Returns an array of Map&lt;Integer,ReadCellData&lt;?&gt;&gt;, where `?` type refers to ACTUAL_DATA.

## ReadSheet (just a Sheet in excel) parameters
| Name                  | Default Value | Description                                                                 |
|-----------------------|---------------|-------------------------------------------------------------------------------|
| sheetNo               | 0             | Code of the sheet to be read, recommended to use this to specify which sheet to read. |
| sheetName             | Empty         | Match the sheet by name.                                                     |

# Writing Operations

## Common Parameters
`WriteWorkbook`, `WriteSheet`, and `WriteTable` all have common parameters, which default to the parent.
| Name                  | Default Value | Description                                                                 |
|-----------------------|---------------|-------------------------------------------------------------------------------|
| converter             | Empty         | Many converters are loaded by default, you can add unsupported fields here. |
| writeHandler          | Empty         | Write handler. Can implement `WorkbookWriteHandler`, `SheetWriteHandler`, `RowWriteHandler`, `CellWriteHandler`, which will be called at different stages of writing to excel. |
| relativeHeadRowIndex   | 0             | Number of rows to leave blank above the excel.                                |
| head                  | Empty         | Either `clazz` or `head`. Reads the list corresponding to the file header and matches the data based on the list. It is recommended to use class. |
| clazz                 | Empty         | Either `head` or `clazz`. Reads the class corresponding to the file header, which can also use annotations. If neither is specified, all data will be read. |
| autoTrim              | true          | Automatically trims the header, reads data, etc.                            |
| use1904windowing      | false         | Excel stores time as a double precision floating point number starting from 1900, but sometimes the default start date is 1904, so setting this value changes the default start to 1904. |
| useScientificFormat   | false         | Whether to use scientific notation for large numerical values when converting numbers to text. |
| needHead              | true          | Whether to write the header to excel.                                        |
| useDefaultStyle       | true          | Whether to use default styles.                                               |
| automaticMergeHead    | true          | Automatically merge headers, matching headers with the same fields up, down, left, and right. |
| excludeColumnIndexes  | Empty         | Exclude indexes of data in the object.                                       |
| excludeColumnFieldNames | Empty       | Exclude fields of data in the object.                                        |
| includeColumnIndexes  | Empty         | Only export indexes of data in the object.                                   |
| includeColumnFieldNames | Empty       | Only export fields of data in the object.                                    |
| orderByIncludeColumn  | false         | @since 3.3.0 When using the parameters includeColumnFieldNames or includeColumnIndexes, it will sort according to the order of the collection passed in. |
| filedCacheLocation    | THREAD_LOCAL  | @since 3.3.0 Parsing class fields will have a cache, previously placed in a global Map, after 3.3.0 it defaults to ThreadLocal, meaning the class will be re-parsed every time it is read and written, and can reflect changes made by reflection to the class's annotations, and concurrent scenarios will not affect each other.<br/>THREAD_LOCAL: Default, the class will be cached every time it is read and written, but not the same time will not affect.<br/>MEMORY: Placed in global memory, theoretically better performance, but cannot modify the exported object through reflection, exclusion, etc.<br/>NONE: No cache, performance will degrade, consider using when reading and writing at the same time, and need to reflect, exclude, etc. to modify the object.

## WriteWorkbook (understood as an excel object) parameters
| Name                  | Default Value | Description                                                                 |
|-----------------------|---------------|-------------------------------------------------------------------------------|
| excelType             | Empty         | The current excel type, supports XLS, XLSX, CSV.                               |
| outputStream          | Empty         | Either `file` or `outputStream`. Writes the file stream.                       |
| file                  | Empty         | Either `outputStream` or `file`. Writes the file.                               |
| templateInputStream   | Empty         | Template file stream.                                                         |
| templateFile          | Empty         | Template file.                                                                |
| charset               | Charset#defaultCharset | Only useful for CSV files, specifies the encoding used when writing the file. |
| autoCloseStream       | true          | Automatically closes the write stream.                                        |
| password              | Empty         | Password for reading the file.                                                |
| inMemory              | false         | Whether to process in memory, by default a temporary file will be generated to save memory. Memory mode is more efficient, but prone to OOM. |
| writeExcelOnException | false         | If an exception occurs during writing, whether to try to write the data to excel. |

## WriteSheet (just a Sheet in excel) parameters
| Name | Default Value | Description |
|-----------------------|-----|---------------------------------|
| sheetNo | 0 | Code of the sheet to write to. |
| sheetName | Empty | Sheet name to write to, defaults to `sheetNo`. |

## WriteTable (a table in excel, a block area) parameters
| Name                  | Default Value | Description |
|-----------------------|---------------|---------------------------------|
| tableNo               | 0             | Code of the table to write to. |

# **WriteHandler**

**`WriteHandler`** is an interface provided by FastExcel for intercepting the writing process when writing to an Excel file, allowing developers to customize operations such as setting cell styles, merging cells, adding hyperlinks, inserting comments, etc. By implementing `WriteHandler`, developers can have fine-grained control over the writing process to meet complex business requirements.

---

## **WriteHandler Interface Categories**

FastExcel provides the following WriteHandler interfaces for handling different writing scenarios:

| Interface Name         | Description                                                                 |
|------------------------|------------------------------------------------------------------------------|
| **CellWriteHandler**   | Interceptor at the cell level, allows custom operations on cell data and styles. |
| **RowWriteHandler**    | Row-level interceptor, used to perform additional operations after row data is written. |
| **SheetWriteHandler**  | Sheet-level interceptor, can be used to set sheet-level properties (such as freeze panes, drop-down lists, etc.). |

---

## **Implementing WriteHandler Steps**

1. **Implement the corresponding `WriteHandler` interface**:
   - Choose the appropriate interface (`CellWriteHandler`, `RowWriteHandler`, or `SheetWriteHandler`).
   - Implement the methods in the interface and define custom logic in the methods.

2. **Register the WriteHandler**:
   - Register your custom WriteHandler when calling `FastExcel.write()` using `.registerWriteHandler()`.

---

## **CellWriteHandler Example: Setting Cell Styles**

### Function: Set the background color to yellow and the font color to blue for all content cells.
```java
@Slf4j
public class CustomCellStyleHandler implements CellWriteHandler {

    @Override
    public void afterCellDispose(CellWriteHandlerContext context) {
        // Ensure only content cells (not headers) are processed
        if (BooleanUtils.isNotTrue(context.getHead())) {
            WriteCellData<?> cellData = context.getFirstCellData();
            WriteCellStyle style = cellData.getOrCreateStyle();

            // Set background color to yellow
            style.setFillForegroundColor(IndexedColors.YELLOW.getIndex());
            style.setFillPatternType(FillPatternType.SOLID_FOREGROUND);

            // Set font color to blue
            WriteFont font = new WriteFont();
            font.setColor(IndexedColors.BLUE.getIndex());
            style.setWriteFont(font);

            log.info("Style set: Row {}, Column {}", context.getRowIndex(), context.getColumnIndex());
        }
    }
}
```

### Register and Use
```java
@Test
public void customCellStyleWrite() {
    String fileName = "customCellStyleWrite.xlsx";

    FastExcel.write(fileName, DemoData.class)
        .registerWriteHandler(new CustomCellStyleHandler())
        .sheet("Custom Style")
        .doWrite(data());
}
```

---

## **RowWriteHandler Example: Inserting Comments**

### Function: Insert a comment at the first row and second column of the header.
```java
@Slf4j
public class CommentRowWriteHandler implements RowWriteHandler {

    @Override
    public void afterRowDispose(RowWriteHandlerContext context) {
        if (BooleanUtils.isTrue(context.getHead())) {
            Sheet sheet = context.getWriteSheetHolder().getSheet();
            Drawing<?> drawing = sheet.createDrawingPatriarch();

            // Create a comment
            Comment comment = drawing.createCellComment(new XSSFClientAnchor(0, 0, 0, 0, (short) 1, 0, (short) 2, 1));
            comment.setString(new XSSFRichTextString("This is a comment"));
            sheet.getRow(0).getCell(1).setCellComment(comment);

            log.info("Comment inserted at the first row and second column");
        }
    }
}
```

### Register and Use
```java
@Test
public void commentWrite() {
    String fileName = "commentWrite.xlsx";

    FastExcel.write(fileName, DemoData.class)
        .registerWriteHandler(new CommentRowWriteHandler())
        .sheet("Insert Comment")
        .doWrite(data());
}
```

---

## **SheetWriteHandler Example: Adding Dropdown Lists**

### Function: Add a dropdown list to the first column of the first two rows.
```java
@Slf4j
public class DropdownSheetWriteHandler implements SheetWriteHandler {

    @Override
    public void afterSheetCreate(SheetWriteHandlerContext context) {
        Sheet sheet = context.getWriteSheetHolder().getSheet();

        // Create dropdown list range
        CellRangeAddressList range = new CellRangeAddressList(1, 2, 0, 0);
        DataValidationHelper helper = sheet.getDataValidationHelper();
        DataValidationConstraint constraint = helper.createExplicitListConstraint(new String[]{"Option 1", "Option 2"});
        DataValidation validation = helper.createValidation(constraint, range);
        sheet.addValidationData(validation);

        log.info("Dropdown list added to the first column of the first two rows");
    }
}
```

### Register and Use
```java
@Test
public void dropdownWrite() {
    String fileName = "dropdownWrite.xlsx";

    FastExcel.write(fileName, DemoData.class)
        .registerWriteHandler(new DropdownSheetWriteHandler())
        .sheet("Add Dropdown")
        .doWrite(data());
}
```

---

## **Summary**

| WriteHandler Type    | Use Case                          | Example                      |
|----------------------|-----------------------------------|------------------------------|
| **CellWriteHandler** | Customizing cell styles, content, merging, etc. | Setting background color, font color, etc. |
| **RowWriteHandler**  | Inserting comments, row-level styles | Inserting comments           |
| **SheetWriteHandler**| Adding dropdown lists, freeze panes | Adding dropdown lists, setting freeze panes |

# **ReadListener**

**`ReadListener`** is an interface provided by FastExcel for handling data processing when reading Excel files. It is one of the core components of FastExcel, allowing developers to implement custom logic to handle data rows, process headers, and even execute specific operations after reading is complete.

---

## **Core Methods of ReadListener**

`ReadListener` is a generic interface, with the generic type being the type of object to be read (e.g., `DemoData`). Its core methods are as follows:

| Method | Description |
|--------|-------------|
| `void invoke(T data, AnalysisContext context)` | Triggered when reading each row of data |


